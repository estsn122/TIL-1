# 銀座Rails

## 令和Devise事情
- Railsに組み込むことができる認証gem。<br>
→OAuth、SAML他多数の認証方式と連携できるからTwitterログインとかが簡単。<br>
→会員登録、パスワード忘れ、アカウントロックなどがbuilt inされている。

- Deviseのデフォルト操作のカスタマイズがし辛い<br>
→デフォルトの動作が作り込まれている分、デフォルトで想定しない実装をしようとすると急に難易度が上がる。<br>
   - devise_forや
   - 初学者がdeviseのwikiをみてコピるのは、動くけど今のRailsらしくない書き方になったり、何をしているのか分からなくなる可能性高いから危険。
   - Userモデルへの機能の集中が大きく、Fatモデルになりがち

- Diviseのメリット<br>
→標準的な認証機能を使えるレベルとして実装しやすいから、サービス立ち上げ期でエンジニアに人的リソースをかけれない時に使ったり。<br>

ex.) ログイン必要→会員登録が必要→メールアドレスでの本人確認(認証)<br>
→サービスが拡大フェーズに入ると、カスタマイズが大変になる。

- 最初にDeviseを組み込んだエンジニアがチームからいなくなっているのも大変。

#### じゃあどうするのか
- ##### なるべくFatモデルにしないよう設計する
  - データが漏れていないかテストコードでチェックする
  - Userモデルをviewに直接渡さず、Decorator、Presentorなどを通すのも良い。
  - Railsで認証せずに、Auth0やAWS cognitoを使う
- User＝ログインアカウントとしてEntityを定義して、ユーザープロフィールというEntityと分ける。
- Rails Tutorialなどを使って、自前で認証系のコードをフル実装して本番に投入するのはやめましょう。
